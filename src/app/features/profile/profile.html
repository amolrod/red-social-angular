<div class="profile-container">
  
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
    <p>Cargando perfil...</p>
  </div>

  <div *ngIf="!isLoading && userProfile" class="profile-content">
    
    <!-- Header del perfil -->
    <mat-card class="profile-header">
      <div class="profile-header-content">
        <div class="avatar">
          <mat-icon>account_circle</mat-icon>
        </div>
        <div class="profile-info">
          <h1>{{ userProfile.displayName || 'Usuario' }}</h1>
          <p class="email">{{ userProfile.email }}</p>
          <p class="bio" *ngIf="userProfile.bio && !isEditing">{{ userProfile.bio }}</p>
        </div>
      </div>
    </mat-card>

    <!-- Estadísticas -->
    <div class="profile-stats">
      <div class="stat-card">
        <mat-icon>article</mat-icon>
        <div class="stat-content">
          <span class="stat-number">{{ (userPosts$ | async)?.length || 0 }}</span>
          <span class="stat-label">Posts</span>
        </div>
      </div>
      
      <div class="stat-card">
        <mat-icon>people</mat-icon>
        <div class="stat-content">
          <span class="stat-number">{{ userProfile.followersCount || 0 }}</span>
          <span class="stat-label">Seguidores</span>
        </div>
      </div>
      
      <div class="stat-card">
        <mat-icon>person_add</mat-icon>
        <div class="stat-content">
          <span class="stat-number">{{ userProfile.followingCount || 0 }}</span>
          <span class="stat-label">Siguiendo</span>
        </div>
      </div>
    </div>

    <!-- Edición del perfil -->
    <mat-card class="edit-profile-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>edit</mat-icon>
          Editar Perfil
        </mat-card-title>
      </mat-card-header>

      <mat-card-content *ngIf="!isEditing">
        <button mat-raised-button color="primary" (click)="toggleEdit()">
          <mat-icon>edit</mat-icon>
          Editar
        </button>
      </mat-card-content>

      <mat-card-content *ngIf="isEditing">
        <mat-form-field class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput [(ngModel)]="editDisplayName" placeholder="Tu nombre">
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Biografía</mat-label>
          <textarea 
            matInput 
            [(ngModel)]="editBio" 
            placeholder="Cuéntanos sobre ti..."
            rows="4">
          </textarea>
        </mat-form-field>

        <div class="edit-actions">
          <button mat-raised-button color="primary" (click)="saveProfile()">
            <mat-icon>save</mat-icon>
            Guardar
          </button>
          <button mat-button (click)="cancelEdit()">
            Cancelar
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Mis posts -->
    <div class="my-posts-section">
      <h2>Mis Posts</h2>

      <div class="posts-list" *ngIf="(userPosts$ | async)?.length; else noPosts">
        <mat-card *ngFor="let post of userPosts$ | async" class="post-card">
          <mat-card-content>
            <div class="post-header">
              <span class="post-date">{{ getPostDate(post.createdAt) | date:'short' }}</span>
              <button 
                mat-icon-button 
                color="warn" 
                (click)="deletePost(post.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            
            <p class="post-content">{{ post.content }}</p>
            
            <div class="post-stats">
              <span class="stat">
                <mat-icon>favorite</mat-icon>
                {{ post.likes }} likes
              </span>
              <span class="stat">
                <mat-icon>comment</mat-icon>
                {{ post.comments.length || 0 }} comentarios
              </span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <ng-template #noPosts>
        <div class="no-posts">
          <mat-icon>post_add</mat-icon>
          <p>Aún no has publicado nada</p>
        </div>
      </ng-template>
    </div>

  </div>

</div>
